function encodeUtf8(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):(127<d&&2048>d?b+=String.fromCharCode(d>>6|192):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128)),b+=String.fromCharCode(d&63|128))}return b}function encodeBase64(a){var b="",c,d,e,f,h,k,l=0;for(a=encodeUtf8(a);l<a.length;)c=a.charCodeAt(l++),d=a.charCodeAt(l++),e=a.charCodeAt(l++),f=c>>2,c=(c&3)<<4|d>>4,h=(d&15)<<2|e>>6,k=e&63,isNaN(d)?h=k=64:isNaN(e)&&(k=64),b=b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(k);return b}var hexcase=0,b64pad="\x3d",chrsz=8;function hex_sha1(a){return binb2hex(core_sha1(str2binb(a),a.length*chrsz))}function b64_sha1(a){return binb2b64(core_sha1(str2binb(a),a.length*chrsz))}function str_sha1(a){return binb2str(core_sha1(str2binb(a),a.length*chrsz))}function hex_hmac_sha1(a,b){return binb2hex(core_hmac_sha1(a,b))}function b64_hmac_sha1(a,b){return binb2b64(core_hmac_sha1(a,b))}function str_hmac_sha1(a,b){return binb2str(core_hmac_sha1(a,b))}function sha1_vm_test(){return"a9993e364706816aba3e25717850c26c9cd0d89d"==hex_sha1("abc")}function core_sha1(a,b){a[b>>5]|=128<<24-b%32;a[(b+64>>9<<4)+15]=b;for(var c=Array(80),d=1732584193,e=-271733879,f=-1732584194,h=271733878,k=-1009589776,l=0;l<a.length;l+=16){for(var m=d,n=e,p=f,q=h,r=k,g=0;80>g;g++){c[g]=16>g?a[l+g]:rol(c[g-3]^c[g-8]^c[g-14]^c[g-16],1);var t=safe_add(safe_add(rol(d,5),sha1_ft(g,e,f,h)),safe_add(safe_add(k,c[g]),sha1_kt(g))),k=h,h=f,f=rol(e,30),e=d,d=t}d=safe_add(d,m);e=safe_add(e,n);f=safe_add(f,p);h=safe_add(h,q);k=safe_add(k,r)}return[d,e,f,h,k]}function sha1_ft(a,b,c,d){return 20>a?b&c|~b&d:40>a?b^c^d:60>a?b&c|b&d|c&d:b^c^d}function sha1_kt(a){return 20>a?1518500249:40>a?1859775393:60>a?-1894007588:-899497514}function core_hmac_sha1(a,b){var c=str2binb(a);16<c.length&&(c=core_sha1(c,a.length*chrsz));for(var d=Array(16),e=Array(16),f=0;16>f;f++)d[f]=c[f]^909522486,e[f]=c[f]^1549556828;c=core_sha1(d.concat(str2binb(b)),512+b.length*chrsz);return core_sha1(e.concat(c),672)}function safe_add(a,b){var c=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(c>>16)<<16|c&65535}function rol(a,b){return a<<b|a>>>32-b}function str2binb(a){for(var b=[],c=(1<<chrsz)-1,d=0;d<a.length*chrsz;d+=chrsz)b[d>>5]|=(a.charCodeAt(d/chrsz)&c)<<24-d%32;return b}function binb2str(a){for(var b="",c=(1<<chrsz)-1,d=0;d<32*a.length;d+=chrsz)b+=String.fromCharCode(a[d>>5]>>>24-d%32&c);return b}function binb2hex(a){for(var b=hexcase?"0123456789ABCDEF":"0123456789abcdef",c="",d=0;d<4*a.length;d++)c+=b.charAt(a[d>>2]>>8*(3-d%4)+4&15)+b.charAt(a[d>>2]>>8*(3-d%4)&15);return c}function binb2b64(a){for(var b="",c=0;c<4*a.length;c+=3)for(var d=(a[c>>2]>>8*(3-c%4)&255)<<16|(a[c+1>>2]>>8*(3-(c+1)%4)&255)<<8|a[c+2>>2]>>8*(3-(c+2)%4)&255,e=0;4>e;e++)b=8*c+6*e>32*a.length?b+b64pad:b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>6*(3-e)&63);return b}myupload={config:{tokenurl:"",addbtn:"",upbtn:"",inputfile:"",uid:0,accesskey:"",secretkey:"",format:0,watermark:0,reserved:1,encrypttype:0,definitions:"0",ifpublic:1,categoryid:0,albumid:0,callback:""},global:{upfiledata:{},upindex:0,uplength:0,mindex:0,filename:"",filesize:0,filetype:"",domain:"http://pyreq.bfvyun.com",errorcode:0,blocksize:0,partnum:1,fileid:[]},method:{changefile:function(){},startup:function(){},upsuccess:function(){},uperror:function(){},upallsuccess:function(){},process:function(){}},init:function(a){$.each(a,function(a,c){myupload.config[a]=c});$.each(a,function(a,c){$.isFunction(myupload.method[a])&&(myupload.method[a]=c)});if(!$("#"+myupload.config.addbtn)||!$("#"+myupload.config.upbtn)||!$("#"+myupload.config.inputfile))return myupload.global.errorcode=107,console.log({status:107}),!1;$("#"+myupload.config.addbtn).click(function(){$("#"+myupload.config.inputfile).trigger("click")});$("#"+myupload.config.inputfile).change(function(){var a=$("#"+myupload.config.inputfile)[0].files,c=a.length;if(c)for(var d=0;d<c&&!(100<=myupload.global.uplength);d++)myupload.global.upfiledata[myupload.global.mindex]=a[d],myupload.global.uplength+=1,myupload.method.changefile(),myupload.global.mindex+=1,$("#"+myupload.config.upbtn).removeClass("no-use").addClass("use");else $("#"+myupload.config.upbtn).removeClass("use").addClass("no-use")});$("#"+myupload.config.upbtn).click(function(){myupload.global.upfiledata&&$.each(myupload.global.upfiledata,function(a,c){myupload.global.upindex=a;return!1});if(!myupload.global.upfiledata[myupload.global.upindex])return alert("\u8bf7\u4e0a\u4f20\u6587\u4ef6"),!1;if(!$(this).hasClass("use"))return!1;myupload.startup()})},settokenurl:function(a){myupload.config.tokenurl=a},setkey:function(a,b){myupload.config.accesskey=a;myupload.config.secretkey=b},upload:function(a){$.each(a,function(a,c){myupload.config[a]=c})},blobslice:function(a,b,c){return a.slice?a.slice(b,c):a.mozSlice?a.mozSlice(b,c):a.webkitSlice?a.webkitSlice(b,c):null},startup:function(){myupload.global.upfiledata&&$.each(myupload.global.upfiledata,function(a,c){myupload.global.upindex=a;return!1});var a=myupload.global.upfiledata[myupload.global.upindex];if(!a)return!1;myupload.global.filename=a.name;myupload.global.filesize=parseInt(a.size);myupload.global.filetype=a.type;a=myupload.global.filename.split(".").pop();a=a.toLowerCase();if(0>$.inArray(a,"mp4 mp4v m4v flv f4v rmvb rm mpg mpeg mpe asf asx wmv wm avi mov mkv 3gp ra dat vob ram".split(" ")))return tobj.text("\u6587\u4ef6\u7c7b\u578b\u6709\u8bef"),delete myupload.global.upfiledata[myupload.global.upindex],myupload.global.uplength--,myupload.startup(),!1;if(!myupload.global.filesize)return tobj.text("\u6587\u4ef6\u5927\u5c0f\u6709\u8bef"),delete myupload.global.upfiledata[myupload.global.upindex],myupload.global.uplength--,myupload.startup(),!1;myupload.method.startup();$("#"+myupload.config.upbtn).removeClass("use").addClass("no-use");a={filename:myupload.global.filename,filesize:myupload.global.filesize,ctype:myupload.global.filetype,categoryid:myupload.config.categoryid,albumid:myupload.config.albumid,ifpublic:myupload.config.ifpublic,callback:myupload.config.callback,format:myupload.config.format,watermark:myupload.config.watermark,reserved:myupload.config.reserved,definitions:myupload.config.definitions,encrypt:myupload.config.encrypttype};myupload.config.accesskey&&myupload.config.secretkey?myupload.gettoken2(a):myupload.gettoken(a)},gettoken:function(a){$.ajax({url:myupload.config.tokenurl,type:"GET",dataType:"json",data:a,success:function(b){if(0==b.status)a.token=b.token,a.sdomain=myupload.global.domain+"/upload/getuploadinfo?token\x3d"+a.token+"\x26ctype\x3d"+myupload.global.filetype,myupload.getuploadurl(a);else return myupload.global.errorcode=100,myupload.method.uperror(),delete myupload.global.upfiledata[myupload.global.upindex],myupload.global.uplength--,myupload.startup(),!1},error:function(){myupload.global.errorcode=100;myupload.method.uperror();delete myupload.global.upfiledata[myupload.global.upindex];myupload.global.uplength--;myupload.startup();return!1}})},gettoken2:function(a){var b=JSON.stringify(a),b=encodeBase64(b),c=b64_hmac_sha1(myupload.config.secretkey,b),b=encodeURIComponent(myupload.config.accesskey+":"+c+":"+b);a.sdomain=myupload.global.domain+"/upload/getuploadinfo?token\x3d"+b+"\x26ctype\x3d"+myupload.global.filetype;myupload.getuploadurl(a)},getuploadurl:function(a){$.ajax({url:a.sdomain,type:"GET",dataType:"json",success:function(b){if(0==b.status)if(a.objname=b.objname.substring(b.objname.indexOf("/"),b.objname.length),a.property=b.property,a.host=b.host,a.blocknum=b.blocknum,a.fileid=b.fileid,myupload.config.uid=b.userid,0==b.uptype)a.sdomain="http://"+b.host+a.objname+"?"+b.signature,myupload.putfile(a);else if(a.blocksize=b.blocksize,myupload.global.blocksize=a.blocksize,a.blocknum=b.blocknum,a.tags={},a.filesize=myupload.global.filesize,"undefined"!=typeof b.uploadid){a.partnum=b.partnumber;myupload.global.oartnum=a.partnum;a.startlength=(a.partnum-1)*a.blocksize;a.endlength=a.startlength+a.blocksize;a.endlength>a.filesize&&(a.endlength=a.filesize);a.tags={};if("undefined"!=typeof b.etags)for(var c=b.etags.length,d=1;d<=c;d++)a.tags[d]=b.etags[d-1];a.uploadid=b.uploadid;a.sdomain="http://"+a.host+a.objname+"?partNumber\x3d"+a.partnum+"\x26uploadId\x3d"+a.uploadid+"\x26"+b.signature;myupload.upsmallfile(a)}else a.sdomain="http://"+a.host+b.objname.substring(b.objname.indexOf("/"),b.objname.length)+"?uploads\x26"+b.signature,myupload.initmulti(a);else return myupload.global.errorcode=b.status,myupload.method.uperror(),delete myupload.global.upfiledata[myupload.global.upindex],myupload.global.uplength--,myupload.startup(),!1},error:function(){myupload.global.errorcode=100;myupload.method.uperror();delete myupload.global.upfiledata[myupload.global.upindex];myupload.global.uplength--;myupload.startup();return!1}})},putfile:function(a){$.ajax({async:!1,contentType:!1,processData:!1,url:a.sdomain,type:"PUT",headers:{Accept:"application/json; charset\x3dutf-8"},data:myupload.global.upfiledata[myupload.global.upindex],beforeSend:function(b){b.setRequestHeader("x-oss-object-acl",a.property);b.setRequestHeader("Access-Control-Allow-Methods","PUT")},success:function(b,c,d){myupload.upsuccess(a)},error:function(){},complete:function(a,c){}})},upsuccess:function(a){$.ajax({async:!1,url:myupload.global.domain+"/upload/uploadfinish?userid\x3d"+myupload.config.uid+"\x26filename\x3d"+encodeURIComponent(a.filename)+"\x26result\x3d0",type:"GET",dataType:"json",success:function(b,c,d){b.status?(myupload.global.errorcode=b.status,myupload.method.uperror()):(myupload.method.upsuccess(),myupload.global.fileid.push(a.fileid),delete myupload.global.upfiledata[myupload.global.upindex],myupload.global.uplength--,0==myupload.global.uplength?($("#"+myupload.config.inputfile).val(""),myupload.method.upallsuccess()):myupload.startup())},error:function(){},complete:function(a,c){}})},initmulti:function(a){$.ajax({async:!1,contentType:!1,processData:!1,url:a.sdomain,type:"POST",dataType:"xml",beforeSend:function(b){b.setRequestHeader("x-oss-object-acl",a.property);b.setRequestHeader("Access-Control-Allow-Methods","POST")},success:function(b,c,d){a.uploadid=$(d.responseText).find("UploadId").text();if(!a.uploadid)return myupload.global.errorcode=100,myupload.method.uperror(),delete myupload.global.upfiledata[myupload.global.upindex],myupload.global.uplength--,myupload.startup(),!1;myupload.reportuploadid(a)},error:function(){},complete:function(a,c){}})},reportuploadid:function(a){$.ajax({async:!1,url:myupload.global.domain+"/upload/reportuploadid?userid\x3d"+myupload.config.uid+"\x26filename\x3d"+a.filename+"\x26uploadid\x3d"+a.uploadid,type:"GET",dataType:"json",success:function(b,c,d){if(b.status)return myupload.global.errorcode=b.status,myupload.method.uperror(),delete myupload.global.upfiledata[myupload.global.upindex],myupload.global.uplength--,myupload.startup(),!1;a.partnum=b.partnumber;myupload.global.partnum=a.partnum;a.sdomain="http://"+a.host+a.objname+"?partNumber\x3d"+a.partnum+"\x26uploadId\x3d"+a.uploadid+"\x26"+b.signature;a.startlength=0;a.endlength=a.startlength+a.blocksize;a.filetag="";myupload.upsmallfile(a)},error:function(){},complete:function(a,c){}})},upsmallfile:function(a){$.ajax({contentType:!1,processData:!1,url:a.sdomain,type:"PUT",headers:{Accept:"application/json; charset\x3dutf-8"},data:myupload.blobslice(myupload.global.upfiledata[myupload.global.upindex],a.startlength,a.endlength),beforeSend:function(b){b.setRequestHeader("x-oss-object-acl",a.property);b.setRequestHeader("Access-Control-Allow-Methods","PUT");myupload.method.process()},success:function(b,c,d){a.filetag=d.getResponseHeader("ETag");a.tags[a.partnum]=a.filetag;a.sdomain=myupload.global.domain+"/upload/updateprogress?userid\x3d"+myupload.config.uid+"\x26filename\x3d"+a.filename+"\x26partnumber\x3d"+a.partnum+"\x26etag\x3d"+a.filetag;a.partnum==a.blocknum&&(a.sdomain+="\x26ctype\x3d"+encodeURIComponent("text/plain;charset\x3dUTF-8"));myupload.updateprogress(a)},error:function(){},complete:function(a,c){}})},updateprogress:function(a){$.ajax({contentType:!1,processData:!1,url:a.sdomain,type:"GET",headers:{Accept:"application/json; charset\x3dutf-8"},success:function(b,c,d){if(b.status)return myupload.global.errorcode=b.status,myupload.method.uperror(),delete myupload.global.upfiledata[myupload.global.upindex],myupload.global.uplength--,myupload.startup(),!1;a.partnum=b.partnumber;myupload.global.partnum=a.partnum;a.endlength>=a.filesize?(a.sdomain="http://"+a.host+a.objname+"?uploadId\x3d"+a.uploadid+"\x26"+b.signature,a.xml='\x3c?xml version\x3d"1.0" encoding\x3d"utf-8" ?\x3e\n\x3cCompleteMultipartUpload\x3e\n',$.each(a.tags,function(b,c){a.xml+="\x3cPart\x3e\n\x3cPartNumber\x3e"+b+"\x3c/PartNumber\x3e\n\x3cETag\x3e"+c+"\x3c/ETag\x3e\n\x3c/Part\x3e\n"}),a.xml+="\x3c/CompleteMultipartUpload\x3e",myupload.compilefiles(a)):(a.startlength=a.endlength,a.endlength=a.startlength+a.blocksize,a.endlength>a.filesize&&(a.endlength=a.filesize),a.sdomain="http://"+a.host+a.objname+"?partNumber\x3d"+a.partnum+"\x26uploadId\x3d"+a.uploadid+"\x26"+b.signature,myupload.upsmallfile(a))},error:function(){},complete:function(a,c){}})},compilefiles:function(a){$.ajax({async:!1,contentType:!1,processData:!1,url:a.sdomain,type:"POST",data:a.xml,dataType:"xml",beforeSend:function(b){b.setRequestHeader("x-oss-object-acl",a.property);b.setRequestHeader("Access-Control-Allow-Methods","POST")},success:function(b,c,d){myupload.upsuccess(a)},error:function(){},complete:function(a,c){}})}};